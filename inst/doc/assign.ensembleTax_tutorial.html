<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Introduction</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h1>Introduction</h1>

<p>This vignette provides detailed examples to demonstrate the functionality of the
<em>assign.ensembleTax</em> algorithm included with the ensembleTax package. For a more
general demonstration of the ensembleTax package functionality/workflow, please 
go here: <a href="https://github.com/dcat4/ensembleTax">https://github.com/dcat4/ensembleTax</a></p>

<h2>The assign.ensembleTax algorithm</h2>

<p><em>assign.ensembleTax</em>&#39;s purpose is to synthesize taxonomic assignments made by 
any number of unique taxonomic assignment methods to determine an &ldquo;ensemble&rdquo; 
assignment for each ASV in a data set. <em>assign.ensembleTax</em> requires that each 
method&#39;s taxonomic assignments follow the same taxonomic nomenclature (naming 
and ranking conventions). If yours don&#39;t, use the <em>taxmapper</em> algorithm included 
with the ensembleTax package (see separate vignette included in this package).</p>

<p>By default, <em>assign.ensembleTax</em> determines the ensemble taxonomic assignment 
for each ASV by finding the highest-frequency taxonomic assignment across the 
input taxonomic assignments (presumably) determined with different methods.</p>

<p><em>assign.ensembleTax</em> includes several user-tuneable parameters that balance 
obtaining assignments for a larger number of ASVs at lower taxonomic ranks (at 
the expense of a likely increase in false-positive annotations) with obtaining 
more robust assignments for fewer ASVs that are supported by multiple methods. 
Here we&#39;ll step through some examples to demonstrate how the algorithm works and
how it&#39;s behavior can be modified by users.</p>

<h3>Examples</h3>

<p>To demonstrate the functionality of <em>assign.ensembleTax</em>, we&#39;ll first create an 
artificial set of ASVs and corresponding taxonomic assignments obtained with 
2 different artificial &ldquo;methods&rdquo;. Note these &ldquo;methods&rdquo; follow the same naming and 
ranking conventions.</p>

<p>So first, load the ensembleTax package, and create the artificial data:</p>

<pre><code class="r">library(&quot;ensembleTax&quot;)
packageVersion(&quot;ensembleTax&quot;)
</code></pre>

<pre><code>## [1] &#39;1.1.1&#39;
</code></pre>

<pre><code class="r"># create a fake taxonomy table of ASVs and taxonomic assignments
taxtab1 &lt;- data.frame(ASV = c(&quot;sv1&quot;, &quot;sv2&quot;, &quot;sv3&quot;, &quot;sv4&quot;),
                          kingdom = c(&quot;Eukaryota&quot;, &quot;Eukaryota&quot;, &quot;Eukaryota&quot;, &quot;Eukaryota&quot;), 
                          supergroup = c(&quot;Stramenopile&quot;, &quot;Stramenopile&quot;, &quot;Alveolata&quot;, &quot;Rhizaria&quot;),
                          division = c(&quot;Ochrophyta&quot;, NA, &quot;Dinoflagellata&quot;, NA),
                          class = c(&quot;Bacillariophyta&quot;, NA, NA, NA),
                          genus = c(&quot;Pseudo-nitzschia&quot;, NA, NA, NA))
taxtab2 &lt;- data.frame(ASV = c(&quot;sv1&quot;, &quot;sv2&quot;, &quot;sv3&quot;, &quot;sv4&quot;),
                          kingdom = c(&quot;Eukaryota&quot;, &quot;Eukaryota&quot;, &quot;Eukaryota&quot;, &quot;Eukaryota&quot;), 
                          supergroup = c(&quot;Stramenopile&quot;, &quot;Alveolata&quot;, &quot;Alveolata&quot;, &quot;Stramenopile&quot;),
                          division = c(&quot;Ochrophyta&quot;, &quot;Dinoflagellata&quot;, &quot;Dinoflagellata&quot;, NA),
                          class = c(&quot;Bacillariophyta&quot;, NA, &quot;Syndiniales&quot;, NA),
                          genus = c(&quot;Pseudo-nitzschia&quot;, NA, NA, NA))
# look at your artificial data:
taxtab1
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>We see across our 4 ASVs, we have certain ASVs for which the assigned taxonomy 
is identical across the two tables, or that vary in the number of ranks with 
assigned names, in the names that were assigned, or both. In what follows we&#39;ll 
see how one might obtain different ensemble assignments based on these data 
for various scientific questions and/or based on assumptions about the 
underlying methods employed to obtain each collection of taxonomic assignments.</p>

<p>Now would be a good time to review the <em>assign.ensembleTax</em> documentation to get
a sense of the different parameter spaces available. Here we&#39;ll try to 
demonstrate what these different parameters are doing.</p>

<h4>Example 1: Simply obtain the highest frequency assignments</h4>

<p>In this example we&#39;ll run <em>assign.ensembleTax</em> with our two taxonomy tables. 
<em>assign.ensembleTax</em> expects a named list of dataframes with each element 
corresponding to a uniquely-named taxonomy table, so we&#39;ll create that first and 
then compute ensemble taxonomic assignments with the default parameters. </p>

<pre><code class="r">xx &lt;- list(taxtab1, taxtab2)
names(xx) &lt;- c(&quot;tab1&quot;,&quot;tab2&quot;)
eTax.def &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx)), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
taxtab1
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.def
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>Let&#39;s break this down. We saw that for sv1, the assignments were in perfect 
agreement across the two tables and this assignment has been retained in the 
ensemble. sv2 and sv4 disagreed at the supergroup rank, and so have been left 
unassigned at the supergroup rank in the ensemble (there is no 
&ldquo;highest-frequency&rdquo; assignment where only two tables are provided and they 
disagree). For sv3, the assignments were identical down to the division rank, 
but one table was unassigned (assigned NA) at the class rank while the other was
assigned to <em>Syndiniales</em>. When <em>count.NA = TRUE</em>, NA values are counted as 
assignments and so again there was no highest frequency assignment at the class 
rank, resulting in the ensemble being assigned only to division where 
&ldquo;Dinoflagellata&rdquo; was assigned in both input tables. </p>

<p>More on that in a sec. First, we&#39;ll add in a third taxonomy table that is 
identical to taxtab1 and compute ensembles with all 3:</p>

<pre><code class="r"># create a 3rd fake taxonomy table of ASVs and taxonomic assignments
taxtab3 &lt;- taxtab1
xx.with3 &lt;- list(taxtab1, taxtab2, taxtab3)
names(xx.with3) &lt;- c(&quot;tab1&quot;, &quot;tab2&quot;, &quot;tab3&quot;)
eTax.def &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.def
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>With 3 taxonomy tables, we see sv2 and sv4 are now assigned at the supergroup 
rank in the ensemble. For each of these, both taxtab1 and taxtab3 agreed in 
their assignments, meaning these assignments were found at a higher frequency 
than the conflicting supergroup assignments in taxtab2.  </p>

<h4>Example 2: The &ldquo;count.na&rdquo; argument</h4>

<p>Here we&#39;ll create two ensembles again with the same combination of taxonomy 
tables, but we&#39;ll set <em>count.na = FALSE</em>. This adjustment is meant for users who 
want to increase the number of annotated ASVs but likely comes at the expense of 
an increase in false positive annotations.</p>

<pre><code class="r">eTax.nona2 &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx)), 
                              tiebreakz = NULL, 
                              count.na=FALSE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.nona2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.nona3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = NULL, 
                              count.na=FALSE, 
                              assign.threshold = 0)
# ensemble with 3 tables:
eTax.nona3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>Here using the 2 taxonomy tables, we see the ensemble assignments for sv1, 2, 
and 4 are identical to the first example. Where there are conflicting 
assignments that are not NA, the <em>count.na</em> argument has no impact on ensemble 
determinations, as you can see in the first ensemble we computed. However, for 
sv3, we see that we now have an ensemble assignment at the class rank 
(&ldquo;Syndiniales&rdquo;) because the NA assignment wasn&#39;t counted (in other words, there 
was 1 Syndiniales and 0 other assignments that were not NA, so the highest 
frequency assignment was Syndiniales).</p>

<p>You might be somewhat surprised to see that sv3&#39;s ensemble class assignment is 
still Syndiniales when we considered all 3 taxonomy tables. In this case NA was 
the highest frequency assignment, but by setting <em>count.na = FALSE</em> we ignored 
the NA assignments and so the highest frequency assignment in the absence of 
NA&#39;s was assigned as the ensemble. </p>

<h4>Example 3: Breaking ties with the &ldquo;tiebreakz&rdquo; argument</h4>

<p>In this example we&#39;ll count NA&#39;s again but we&#39;ll specify that we&#39;d like to 
prioritize particular taxonomy tables in the event that multiple disagreeing 
assignments are found at the highest frequency. Again, using our same 3 tables 
as above.</p>

<pre><code class="r">eTax.tb2 &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx)), 
                              tiebreakz = c(&quot;tab2&quot;), 
                              count.na=TRUE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.tb2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.tb3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = c(&quot;tab2&quot;), 
                              count.na=TRUE, 
                              assign.threshold = 0)
# ensemble with 3 tables:
eTax.tb3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>In both ensembles we prioritized assignments in taxtab2 in the event of ties. 
When only 2 taxonomy tables were used to compute the ensemble, the ensemble 
assignments are identical to taxtab2 (the table we chose to break ties with). 
Makes sense. The ensemble computed with 3 tables was not impacted by 
tie-breaking because taxtab1 and 3 are identical, and so all assignments in 
these two tables will be found at the highest frequency and there will be no 
ties.</p>

<p>One more example computing an ensemble with taxtabs 1 and 2, but prioritizing 
taxtab1 to break ties and NOT counting NA&#39;s:</p>

<pre><code class="r">eTax.tb2 &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx)), 
                              tiebreakz = c(&quot;tab1&quot;), 
                              count.na=FALSE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
taxtab1 
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.tb2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>If you&#39;d like to primarily rely on assignments from one assignment method, but 
use a second method to fill in annotations where your favorite method is not 
assigned (assigned NA), you can specify a tiebreaker and ignore NA&#39;s in your 
ensemble assignment determinations.</p>

<h4>Example 4: Prioritizing methods with the &ldquo;weights&rdquo; argument</h4>

<p>Another way you can prioritize assignments from one (or more) particular 
assignment method is by using the weights argument. Weights are specified as 
integers in the order corresponding to the order of taxonomy tables in the list 
you supply to <em>assign.ensembleTax</em>. Weighting one table more highly than the 
other in ensembles determined from only two taxonomy tables will result in 
identical behavior as tie-breaking. Below we&#39;ve weighted assignments in taxtab1 
double those found in taxtab2:</p>

<pre><code class="r"># counting NA&#39;s:
eTax.wt2 &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=c(2,1), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.wt2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r"># NOT counting NA&#39;s:
eTax.wt2 &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=c(2,1), 
                              tiebreakz = NULL, 
                              count.na=FALSE, 
                              assign.threshold = 0)
# show the initials and ensemble for ease-of-interpretation:
eTax.wt2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>Just as expected. The ensemble assignments are identical to taxtab1 when we 
count NA&#39;s, but when we ignore NA&#39;s the Syndiniales assignment is filled in by 
taxtab2. </p>

<p>What happens when we compute a 3-table ensemble but weight the table that 
disagrees with the other two (taxtab2) 2x? Let&#39;s see:</p>

<pre><code class="r">eTax.wt3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=c(1,2,1), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0)
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.wt3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>We see that anywhere where taxonomic assignments were in disagreement, they are 
not assigned in the ensemble. This is because taxtab 1 and 3 are identical to 
one another, and we&#39;ve weighted taxtab2 double. So where assignments disagree 
there are multiple assignments with the highest frequency. That means we need to 
specify a tiebreaker if we want to avoid the above scenario. Let&#39;s try:</p>

<pre><code class="r">eTax.wttb3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=c(1,2,1), 
                              tiebreakz = c(&quot;tab1&quot;), 
                              count.na=TRUE, 
                              assign.threshold = 0)
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.wttb3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>And now our ensemble determinations match taxtab1 (and 3) where there were 
disagreements with taxtab2. We can prioritize taxtab2 and see the opposite:</p>

<pre><code class="r">eTax.wttb3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=c(1,2,1), 
                              tiebreakz = c(&quot;tab2&quot;), 
                              count.na=TRUE, 
                              assign.threshold = 0)
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.wttb3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>Just as we expected. </p>

<h4>Example 5: the &ldquo;assign.threshold&rdquo; argument</h4>

<p>We have one last argument to address: <em>assign.threshold</em>. This argument 
interacts with some of the other arguments we&#39;ve looked at above in ways that 
may be counter-intuitive to some, so make sure you understand what each of those
arguments are doing before spending too much time with <em>assign.threshold</em>.</p>

<p>Let&#39;s take a look at some different thresholds alongside our default parameters 
first. We&#39;ll see how changing <em>assign.threshold</em> can impact tiebreaking and 
weighting first:</p>

<pre><code class="r"># tie-breaking to prioritize table 1, but with assign.threshold = 60%
eTax.at &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx)), 
                              tiebreakz = c(&quot;tab1&quot;), 
                              count.na=TRUE, 
                              assign.threshold = 0.6)
# show the initials and ensemble for ease-of-interpretation:
taxtab1 # (remember taxtab3 is identical to this, so count 2x)
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">taxtab2
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r">eTax.at
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r"># take away the tiebreaker and weight table 1 2x:
eTax.at &lt;- assign.ensembleTax(xx, 
                              tablenames = names(xx), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=c(2,1), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0.6)
eTax.at
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>Here we see that the <em>assign.threshold</em> argument &ldquo;over-rules&rdquo; tie-breaking if 
the threshold is not satisfied. Although we specified taxtab1 as the 
tie-breaker, by designating <em>assign.threshold = 0.6</em>, we&#39;ve required ensemble 
assignments to be found in at least 60% of the (weighted) assignments. This 
means disagreements were left unassigned here.</p>

<p>If we take a look at the 2nd ensemble we computed (where tie-breaking was 
omitted and we instead weighted taxtab1 2x), we see that our ensemble mirrors 
taxtab1. This is because the <em>assign.threshold</em> argument operates on weighted 
assignment frequencies. In this case,  where taxtab 1 and 2 disagreed, the 
assignments in taxtab1 comprised 66% of the weighted assignments, which was 
larger than our <em>assign.threshold</em>.</p>

<p>Let&#39;s try a couple thresholds applied to 3-table ensemble determinations:</p>

<pre><code class="r"># a low threshold:
eTax.at3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0.5)
eTax.at3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r"># a high threshold (need all 3 to agree here for ensemble assignment):
eTax.at3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = NULL, 
                              count.na=TRUE, 
                              assign.threshold = 0.9)
eTax.at3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata            &lt;NA&gt;             &lt;NA&gt;
## 4 sv4 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>In our first example, the threshold we applied (0.5) has no impact on the 
ensemble assignments because taxtab1 and 3 are identical, and therefore their 
assignments will always comprise more than 50% of the assignments for any ASV. </p>

<p>In our second example, the threshold of 0.9 (and in this case, any threshold &gt; 
0.67) means that the ensemble is only assigned where all three input taxonomy 
tables are in agreement. </p>

<p>Finally, we&#39;ll take a look at how <em>assign.threshold</em> behaves when 
<em>count.na = FALSE</em>:</p>

<pre><code class="r"># a low threshold with count.na = FALSE:
eTax.at3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = NULL, 
                              count.na=FALSE, 
                              assign.threshold = 0.5)
eTax.at3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota Stramenopile           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota     Rhizaria           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<pre><code class="r"># a high threshold with count.na = FALSE (need all 3 to agree here for ensemble assignment):
eTax.at3 &lt;- assign.ensembleTax(xx.with3, 
                              tablenames = names(xx.with3), 
                              ranknames = colnames(taxtab1)[2:ncol(taxtab1)],
                              weights=rep(1,length(xx.with3)), 
                              tiebreakz = NULL, 
                              count.na=FALSE, 
                              assign.threshold = 0.9)
eTax.at3
</code></pre>

<pre><code>##   ASV   kingdom   supergroup       division           class            genus
## 1 sv1 Eukaryota Stramenopile     Ochrophyta Bacillariophyta Pseudo-nitzschia
## 2 sv2 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
## 3 sv3 Eukaryota    Alveolata Dinoflagellata     Syndiniales             &lt;NA&gt;
## 4 sv4 Eukaryota         &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;
</code></pre>

<p>We again see that when the threshold is low (0.5), it has little impact on our 
ensemble assignments.</p>

<p>However, implementing a high threshold (0.9) in conjunction with 
<em>count.na = FALSE</em> notably alters the ensemble assignments. For sv2 and sv4, 
where taxonomic names (and not NA&#39;s) were assigned and disagreed across the 3 
tables, the ensemble remains unassigned because no single assignment was found 
at a frequency greater than 90%. However, for sv3, where 66% of the input class
assignments were NA and 33% were Syndiniales, the ensemble is assigned to the 
class Syndiniales. This is because the <em>assign.threshold</em> does not consider NA 
assignments when <em>count.na = FALSE</em>. In other words, because NA&#39;s were ignored, 
in this example the Syndiniales assignment comprised 100% of the input 
assignments and thus surpassed the <em>assign.threshold</em>. </p>

<h3>Parameter summary and recommendations for different scientific objectives</h3>

<p>As you can see in the above, the <em>assign.ensembleTax</em> algorithm allows for 
flexible computations of ensemble taxonomic assignments to suit different 
scientific questions and applications. There are trade-offs in adjusting each of
the above parameters and here we&#39;ll discuss what those are and how you might 
implement <em>assign.ensembleTax</em> for your own objectives. </p>

<p>The big trade-off one should consider when implementing <em>assign.ensembleTax</em> is 
how to balance annotating more ASVs at lower ranks vs. only annotating ASVs 
where annotations are supported by multiple methods (and thus are likely to be 
quite robust). The former likely comes at the expense of increased false 
positive annotations (ASVs assigned to a lineage where there really is not 
enough information to make this determination), while the latter likely comes at
the expense of increased false negative annotations (assigning NA where there IS 
enough information to assign the ASV to a lineage). Adjusting the parameters in<br/>
<em>assign.ensembleTax</em> allows you to decide where you fall on this spectrum.</p>

<p>First, we&#39;ll consider parameters that will promote robust annotations where ASVs
are assigned to a taxonomic group at the expense of assigning taxonomy to a 
smaller number of ASVs/ranks. Arguments that would favor this strategy are:
(1) <em>count.na = TRUE</em>
(2) <em>assign.threshold = [a high value, say &gt; 0.5]</em>
(3) <em>tiebreakz = NULL</em>
One could use all of the above settings, or select a few. Broadly, all of these 
parameters require a taxonomic assignment for a particular ASV to be found in 
multiple input taxonomy tables in order for it to be assigned to the ensemble. 
Implementing all of these simultaneously will result in extremely conservative, 
but extremely well-supported taxonomic assignments. These settings are probably 
most appropriate for studies that require precise identification of particular 
ASVs. While lower-rank assignments should in general be interpreted with 
caution, those supported by multiple methods are likely less error-prone than 
those determined with a single method.</p>

<p>Let&#39;s say you think (or know), that assignments made by one particular method 
are more accurate than the other methods you&#39;ve considered. Perhaps the 
reference database uses a more robust annotation procedure, or benchmarking 
exercises show a particular classifier has very low error rates. You can 
prioritize assignments made by this method with the <em>tiebreakz</em> or <em>weights</em> 
argument. If you wanted to use secondary methods to &ldquo;fill in&rdquo; assignments where 
your preferred method determined that taxonomy could not be assigned to an ASV, 
you could subsequently change the <em>count.na</em> argument. These changes bring you 
closer to the other end of the spectrum&hellip;</p>

<p>At the other end of the spectrum, we&#39;ll consider parameters that promote 
obtaining annotations at lower ranks for a greater number of ASVs at the expense
of potentially increasing the number of spurious classifications (either 
assigning ASVs to an incorrect lineage, or assigning an ASV to a lineage when 
there is not sufficient phylogenetic resolution to do so). Arguments that would 
favor this strategy are:
(1) <em>count.na = FALSE</em>
(2) <em>assign.threshold = [a low value, say 0]</em>
(3) <em>tiebreakz = [specify the names of ALL input tables in order of priority]</em>
Broadly, all of these parameters favor an increase in the number of ASVs 
assigned at lower ranks, but these assignments may only be supported by a single
method and so may be less robust. These settings are probably most appropriate 
for studies focused on very broad taxonomic groupings; lower-rank assignments 
should in general be interpreted with caution, and this is particularly true 
when ensemble assignments are computed with these parameters.</p>

<p>That brings us to the end of this tutorial. We include some code for comparing 
ensemble taxonomic assignments in our ensembleTax package overview vignette, and
encourage you to perform such comparisons to test out different settings and 
optimize ensemble assignments for your particular scientific objectives.</p>

</body>

</html>
